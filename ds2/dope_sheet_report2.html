<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Dope Sheet</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* A little custom CSS for finer control */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc; /* A light gray background */
        }
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        h1, h2, h3 {
            font-weight: 700;
        }
        /* Custom styling for the blockquote to match the original feel */
        .soundbite-quote {
            border-left: 4px solid #e2e8f0;
            padding-left: 1rem;
            margin-top: 0rem; /* Adjusted for new layout */
            font-style: italic;
            color: #475569;
        }
    </style>
</head>
<body class="text-slate-800">

    <header class="bg-gray-800 text-white py-3 px-6 flex items-center justify-between border-b-4 border-sky-500">
        <div class="flex items-center gap-4">
            <img src="Newspath logo.PNG" alt="CBS Newspath Now Logo" class="h-10">
            <span class="text-xl font-medium text-gray-200 hidden sm:block">Dope Sheets</span>
        </div>
        
        <div class="flex items-baseline gap-2"> 
            <span class="text-sm text-gray-400 relative top-[5px]">powered by</span> <img src="VideoShipLogo@2x.png" alt="VideoShip Logo" class="h-8 self-center">
            <span class="text-base font-medium text-gray-300 italic relative top-[5px]">MediaLab</span> </div>
    </header>

    <div id="dope-sheet-container" class="max-w-4xl mx-auto p-4 sm:p-6 md:p-8">
        </div>

    <script>
        // --- DATA SOURCE ---
        const dopeSheetData = {
  "export_thumbnail": { "frame": 1441, "sec": 48.081 },
  "headline": "Autism-Friendly Car Wash Creates Employment Opportunities",
  "summary": "Rising Tide Car Wash employs over 100 workers with autism, providing meaningful employment and community integration.",
  "tone_tags": ["Inspiring", "Documentary", "Community-focused"],
  "synopsis": "Rising Tide Car Wash in Coral Springs, Florida, represents a groundbreaking approach to employment for individuals with autism spectrum disorders. Founded by Thomas Deery and his father to provide opportunities for Thomas's younger brother Andrew and others like him, the business has grown to employ more than 100 people across three locations, with over 80% of staff members having autism. The initiative addresses the significant unemployment challenges faced by the autism community, where rates can reach as high as 80% according to various studies.\n\nThe car wash has become more than just a businessâ€”it's a transformative space where employees develop valuable skills, earn meaningful wages, and build lasting friendships. Workers like 17-year-old Edward Cruz express genuine pride in their contributions, emphasizing how the work makes a real difference in customers' lives. For families like the Deerys, the business has brought the family closer together while demonstrating that employees with autism not only meet expectations but often exceed them through their genuine dedication and attention to detail.",
  "topic_tags": ["Autism employment", "Inclusive business", "Community impact", "Family business", "Disability advocacy", "Workforce development"],
  "chapters": [
    {
      "title": "Introduction and Employment Challenge",
      "description": "Opening introduces Edward Cruz and the broader unemployment crisis facing people with autism.",
      "representative_keyframe": { "frame": 382, "sec": 12.746 },
      "chapter_in_point": { "frame": 1091, "sec": 36.403 },
      "chapter_out_point": { "frame": 825, "sec": 27.527 },
      "sound_bites": []
    },
    {
      "title": "Edward's Personal Experience",
      "description": "Edward Cruz shares his perspective on working at Rising Tide and the impact it has made.",
      "representative_keyframe": { "frame": 895, "sec": 29.863 },
      "chapter_in_point": { "frame": 822, "sec": 27.427 },
      "chapter_out_point": { "frame": 1097, "sec": 36.603 },
      "sound_bites": [
        {
          "text": "I'm happy that what we do, it really does make a difference.",
          "speaker_name": "Edward Cruz",
          "in_point": { "frame": 1001, "sec": 33.400 },
          "out_point": { "frame": 1099, "sec": 36.669 }
        }
      ]
    },
    {
      "title": "Family Story and Business Origins",
      "description": "Thomas Deery explains how Rising Tide began as a solution for his brother Andrew's future.",
      "representative_keyframe": { "frame": 1157, "sec": 38.605 },
      "chapter_in_point": { "frame": 1094, "sec": 36.503 },
      "chapter_out_point": { "frame": 1559, "sec": 52.018 },
      "sound_bites": [
        {
          "text": "we were going to have to take action in order for him to lead the full adult life that we knew he was capable of.",
          "speaker_name": "Thomas Deery",
          "in_point": { "frame": 1522, "sec": 50.800 },
          "out_point": { "frame": 1663, "sec": 55.487 }
        }
      ]
    },
    {
      "title": "Andrew's Transformation and Success",
      "description": "Thomas describes how the car wash has transformed Andrew's life and brought the family together.",
      "representative_keyframe": { "frame": 1696, "sec": 56.590 },
      "chapter_in_point": { "frame": 1552, "sec": 51.785 },
      "chapter_out_point": { "frame": 1897, "sec": 63.296 },
      "sound_bites": [
        {
          "text": "Today he has friends, he has a community of peers, he has money in his pocket... and it's brought our family together.",
          "speaker_name": "Thomas Deery",
          "in_point": { "frame": 1664, "sec": 55.507 },
          "out_point": { "frame": 1900, "sec": 63.400 }
        }
      ]
    },
    {
      "title": "Business Success and Employee Excellence",
      "description": "Thomas explains how employees with autism exceed expectations through genuine dedication.",
      "representative_keyframe": { "frame": 2154, "sec": 71.878 },
      "chapter_in_point": { "frame": 1894, "sec": 63.196 },
      "chapter_out_point": { "frame": 2375, "sec": 79.252 },
      "sound_bites": [
        {
          "text": "They're going to exceed expectations because our team genuinely want to be here.",
          "speaker_name": "Thomas Deery",
          "in_point": { "frame": 2237, "sec": 74.651 },
          "out_point": { "frame": 2376, "sec": 79.278 }
        }
      ]
    },
    {
      "title": "Andrew's Voice and Daily Work",
      "description": "Andrew shares his enthusiasm for work and customers while demonstrating his skills.",
      "representative_keyframe": { "frame": 2781, "sec": 92.799 },
      "chapter_in_point": { "frame": 2372, "sec": 79.152 },
      "chapter_out_point": { "frame": 2982, "sec": 99.506 },
      "sound_bites": []
    }
  ],
  "key_entities": [
    {
      "name": "Edward Cruz",
      "keyframe_image": { "frame": 382, "sec": 12.746 },
      "bounding_box": { "width": 250, "height": 250, "x": 483, "y": 147 },
      "entity_role": "subject",
      "entity_flags": ["subject", "employee"],
      "details": [
        "17-year-old employee at Rising Tide Car Wash",
        "Person with autism who takes pride in his work",
        "Organizes supplies and assists customers",
        "Believes his work makes a real difference"
      ]
    },
    {
      "name": "Thomas Deery", 
      "keyframe_image": { "frame": 1441, "sec": 48.081 },
      "bounding_box": { "width": 250, "height": 250, "x": 516, "y": 145 },
      "entity_role": "subject",
      "entity_flags": ["subject", "business_owner", "family_member"],
      "details": [
        "Co-founder of Rising Tide Car Wash with his father",
        "Brother to Andrew Deery",
        "Advocate for autism employment opportunities",
        "Believes employees with autism exceed expectations"
      ]
    },
    {
      "name": "Andrew Deery",
      "keyframe_image": { "frame": 2781, "sec": 92.799 },
      "bounding_box": { "width": 250, "height": 250, "x": 465, "y": 137 },
      "entity_role": "subject", 
      "entity_flags": ["subject", "employee", "family_member"],
      "details": [
        "Younger brother of Thomas Deery",
        "Employee with autism at Rising Tide Car Wash",
        "Specializes in tire shine work",
        "Inspiration for the business creation"
      ]
    },
    {
      "name": "Cristian Benavides",
      "keyframe_image": { "frame": 1935, "sec": 64.571 },
      "bounding_box": { "width": 250, "height": 250, "x": 515, "y": 140 },
      "entity_role": "journalist",
      "affiliation": "CBS News", 
      "entity_flags": ["journalist", "narrator"],
      "details": [
        "Role: Journalist narrator",
        "Affiliation: CBS News", 
        "Contribution: Reports from Coral Springs, Florida"
      ]
    },
    {
      "name": "Rising Tide Car Wash",
      "keyframe_image": { "frame": 1130, "sec": 37.704 },
      "bounding_box": { "width": 450, "height": 450, "x": 425, "y": 135 },
      "entity_role": "organization",
      "entity_flags": ["business", "inclusive_employer"],
      "details": [
        "Car wash business in Coral Springs, Florida",
        "Employs over 100 people across three locations", 
        "More than 80% of staff have autism",
        "Founded to provide employment opportunities for people with autism"
      ]
    }
  ]
};

        const isJournalist = (e) =>
            e?.entity_role === "journalist" || e?.entity_flags?.includes("journalist");

        // --- DYNAMIC PAGE BUILDER ---
        document.addEventListener('DOMContentLoaded', () => {
            const container = document.getElementById('dope-sheet-container');
            if (!container || !dopeSheetData) {
                console.error("Container or data not found!");
                return;
            }

            // --- NEW: Separate the journalist from other entities ---
            const journalistEntity = (dopeSheetData.key_entities || []).find(isJournalist);
            const regularEntities  = (dopeSheetData.key_entities || []).filter(e => !isJournalist(e));

            const entityImageMap = new Map();
            dopeSheetData.key_entities.forEach((entity, index) => {
                const imageUrl = `entity_${index + 1}.jpg`;
                entityImageMap.set(entity.name, imageUrl);
            });

            document.title = dopeSheetData.headline || 'Interactive Dope Sheet';
            const formatSynopsis = (text) => text.split('\n\n').map(p => `<p class="mb-4">${p}</p>`).join('');
            const descriptiveTags = dopeSheetData.descriptive_tags || dopeSheetData.tone_tags || [];

            // --- UPDATED: This entire innerHTML block is new ---
            container.innerHTML = `
                <header class="mb-12">
                    <h1 class="text-3xl md:text-4xl font-bold text-slate-900 mb-2">${dopeSheetData.headline}</h1>
                    <p class="text-lg text-slate-600 italic">${dopeSheetData.summary}</p>
                    ${ (descriptiveTags.length > 0) ? `<div class="flex items-center gap-2 text-sm text-slate-500 font-medium mt-3">${descriptiveTags.map(tag => `<span>${tag}</span>`).join('<span class="mx-1">&middot;</span>')}</div>` : '' }

                <main>
                    <section id="video-player-container" class="mb-8">
                        <video id="main-video" controls class="w-full rounded-lg shadow-lg bg-black" poster="thumbnail.jpg">
                            <source src="video3.mp4" type="video/mp4">
                            Your browser does not support the video tag.
                        </video>
                    </section>

                    <section id="synopsis" class="mb-8 bg-white p-6 rounded-lg shadow-sm">
                        <h2 class="text-2xl font-bold border-b pb-2 mb-4">Synopsis</h2>
                        <div>${formatSynopsis(dopeSheetData.synopsis)}</div>
                    </section>

                    <section id="topic-tags" class="mb-8">
                        <h2 class="text-2xl font-bold border-b pb-2 mb-4">Topic Tags</h2>
                        <div class="flex flex-wrap gap-2">${dopeSheetData.topic_tags.map(tag => `<span class="bg-sky-100 text-sky-800 text-sm font-medium px-3 py-1 rounded-full">${tag}</span>`).join('')}</div>
                    </section>
                    
                    ${journalistEntity ? `
                    <section id="journalist" class="mb-8">
                    <h2 class="text-2xl font-bold border-b pb-2 mb-4">Journalist</h2>
                    <div class="bg-white p-4 rounded-lg shadow-sm flex items-center gap-5">
                        ${journalistEntity.keyframe_image ? `
                        <img src="entity_${dopeSheetData.key_entities.indexOf(journalistEntity) + 1}.jpg"
                            alt="${journalistEntity.name}"
                            class="w-20 h-20 rounded-full object-cover bg-slate-200 flex-shrink-0">
                        ` : ''}

                        <div class="flex-grow">
                        <div class="flex items-center gap-2 flex-wrap">
                            <h3 class="font-bold text-lg text-slate-900">${journalistEntity.name}</h3>
                            <span class="text-xs uppercase tracking-wide px-2 py-1 rounded-full bg-slate-800 text-white">Journalist</span>
                            ${journalistEntity.affiliation ? `
                            <span class="text-xs px-2 py-1 rounded-full bg-sky-100 text-sky-800">
                                ${journalistEntity.affiliation}
                            </span>` : `
                            <span class="text-xs px-2 py-1 rounded-full bg-amber-100 text-amber-800">
                                Affiliation: Unknown
                            </span>`}
                        </div>

                        <ul class="w-full text-sm text-slate-600 mt-2 list-disc list-outside ml-4 text-left">
                            ${ (journalistEntity.details || []).map(detail => `<li>${detail}</li>`).join('') }
                        </ul>
                        </div>
                    </div>
                    </section>
                    ` : '' }

                    ${regularEntities.length > 0 ? `
                    <section id="key-entities" class="mb-8">
                        <h2 class="text-2xl font-bold border-b pb-2 mb-4">Main Characters</h2>
                        <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4">
                            ${regularEntities.map(entity => {
                                const originalIndex = dopeSheetData.key_entities.indexOf(entity);
                                return `
                                <div class="bg-white p-4 rounded-lg shadow-sm flex flex-col items-center text-center">
                                    <img src="entity_${originalIndex + 1}.jpg" alt="${entity.name}" class="w-24 h-24 rounded-full mb-3 object-cover bg-slate-200">
                                    <div class="flex items-center gap-2 flex-wrap">
                                        <h3 class="font-bold text-lg text-slate-900">${entity.name}</h3>
                                        ${entity.entity_role ? `<span class="text-xs px-2 py-1 rounded-full bg-slate-100 text-slate-700">
                                            ${entity.entity_role}
                                        </span>` : ''}
                                        </div>
                                    <ul class="text-sm text-slate-600 mt-2 list-disc list-outside text-left ps-8">${entity.details.map(detail => `<li>${detail}</li>`).join('')}</ul>
                                </div>
                            `}).join('')}
                        </div>
                    </section>
                    ` : ''}
                    
                    <section id="key-chapters">
                        <h2 class="text-2xl font-bold border-b pb-2 mb-4">Story Beats</h2>
                        <div class="space-y-6">
                            ${dopeSheetData.chapters.map((chapter, index) => `
                                <div class="key-chapter bg-white p-4 rounded-lg shadow-sm flex flex-col md:flex-row gap-4 items-start">
                                    <div class="w-full md:w-1/3 flex-shrink-0">
                                        <video id="chapter-video-${index}" class="chapter-video w-full rounded-md cursor-pointer bg-black"
                                            poster="chapter_${index + 1}.jpg"
                                            preload="metadata" muted loop
                                            data-video-id="chapter-video-${index}"
                                            data-start-time="${chapter.chapter_in_point.sec}">
                                            <source src="video3.mp4" type="video/mp4">
                                        </video>
                                    </div>
                                    <div class="key-chapter-text flex-grow">
                                        <h3 class="timestamp-link text-lg font-semibold text-sky-700 hover:text-sky-900 cursor-pointer" 
                                            data-video-id="chapter-video-${index}" 
                                            data-start-time="${chapter.chapter_in_point.sec}">
                                            ${chapter.title}
                                        </h3>
                                        <p class="text-slate-600 mt-1">${chapter.description}</p>
                                        ${chapter.sound_bites.map(sb => `
                                            <figure class="mt-4">
                                                <blockquote class="soundbite-quote m-0 p-0 border-l-4 border-slate-200 pl-3">
                                                    <p>"${sb.text}"</p>
                                                </blockquote>
                                                <figcaption class="text-right text-sm font-semibold text-slate-700 mt-1">- ${sb.speaker_name}</figcaption>
                                            </figure>
                                        `).join('')}
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </section>
                </main>
            `;
            
            setupVideoInteractivity();
        });

        function setupVideoInteractivity() {
            const mainVideo = document.getElementById('main-video');
            
            // This will keep track of which chapter thumbnail was clicked
            let lastClickedchapterVideo = null;

            // When the main video finishes playing, reset the last clicked thumbnail to show its poster
            mainVideo.addEventListener('ended', () => {
                if (lastClickedchapterVideo) {
                    lastClickedchapterVideo.load(); // .load() resets the video element to its initial state
                    lastClickedchapterVideo = null; // Clear the tracker
                }
            });

            // Handle clicks on any key chapter title or thumbnail
            document.getElementById('key-chapters').addEventListener('click', (event) => {
                const target = event.target.closest('.timestamp-link, .chapter-video');
                if (!target) return;

                // Find the specific <video> element for the chapter that was clicked
                const clickedVideoId = target.dataset.videoId;
                if (!clickedVideoId) return;
                
                const clickedVideoElement = document.getElementById(clickedVideoId);
                
                // If another chapter's playback was triggered previously, reset its thumbnail first
                if (lastClickedchapterVideo && lastClickedchapterVideo !== clickedVideoElement) {
                     lastClickedchapterVideo.load();
                }

                // Store a reference to the new chapter video that was clicked
                lastClickedchapterVideo = clickedVideoElement;

                // Get the start time from the element's data attribute
                const startTime = parseFloat(target.dataset.startTime);
                
                // Jump the main video to the correct time and play
                mainVideo.currentTime = startTime;
                mainVideo.play();

                // Bring the main video into view for the user for a better experience
                mainVideo.scrollIntoView({ behavior: 'smooth', block: 'center' });
            });
        }
    </script>

</body>
</html>