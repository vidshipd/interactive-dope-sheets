<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Dope Sheet</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* A little custom CSS for finer control */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc; /* A light gray background */
        }
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        h1, h2, h3 {
            font-weight: 700;
        }
        /* Custom styling for the blockquote to match the original feel */
        .soundbite-quote {
            border-left: 4px solid #e2e8f0;
            padding-left: 1rem;
            margin-top: 0rem; /* Adjusted for new layout */
            font-style: italic;
            color: #475569;
        }
    </style>
</head>
<body class="text-slate-800">

    <header class="bg-gray-800 text-white py-3 px-6 flex items-center justify-between border-b-4 border-sky-500">
        <div class="flex items-center gap-4">
            <img src="Newspath logo.PNG" alt="CBS Newspath Now Logo" class="h-10">
            <span class="text-xl font-medium text-gray-200 hidden sm:block">Dope Sheets</span>
        </div>
        
        <div class="flex items-baseline gap-2"> 
            <span class="text-sm text-gray-400 relative top-[5px]">powered by</span> <img src="VideoShipLogo@2x.png" alt="VideoShip Logo" class="h-8 self-center">
            <span class="text-base font-medium text-gray-300 italic relative top-[5px]">MediaLab</span> </div>
    </header>
    ```

    <div id="dope-sheet-container" class="max-w-4xl mx-auto p-4 sm:p-6 md:p-8">
        </div>

    <script>
        // --- DATA SOURCE ---
        const dopeSheetData = {
  "export_thumbnail": {
    "frame": 420,
    "sec": 14.014
  },
  "headline": "Virginia Anti-War Protesters Oppose Iran Strikes",
  "summary": "Richmond protesters gather opposing Trump's Iran military strikes as Virginia lawmakers show divided reactions.",
  "tone_tags": ["Concerned", "Investigative", "Contemporary"],
  "synopsis": "Following President Trump's announcement of successful U.S. military strikes on Iran's three nuclear facilities, anti-war protesters gathered at Richmond's Abner Clay Park to voice opposition. Around 50 demonstrators, including members of Veterans for Peace and the Party for Socialism and Liberation, expressed concerns that the strikes could lead to retaliation and escalation in the Middle East. Rain Burrows, speaking for Veterans for Peace, emphasized that the majority of Americans do not want war with Iran.\n\nVirginia lawmakers have shown divided responses to the president's decision. Republican Congressman John McGuire supported the strikes, stating that Iran can never be allowed nuclear weapons and citing the country's history as a state sponsor of terror. Governor Glenn Youngkin praised Trump for keeping his promises regarding Iran. However, Democratic Senator Mark Warner, while acknowledging Iran's threat to regional stability, raised concerns about conducting military strikes without congressional authorization or consultation, questioning the constitutional process behind such significant military action.",
  "topic_tags": ["Iran", "Military Strikes", "Protest", "Virginia Politics", "Anti-War", "Nuclear Weapons", "Congressional Authorization"],
  "chapters": [
    {
      "title": "Trump Announces Iran Strikes",
      "description": "President Trump's announcement of successful military strikes on Iran's nuclear facilities.",
      "representative_keyframe": {
        "frame": 60,
        "sec": 2.002
      },
      "chapter_in_point": {
        "frame": 0,
        "sec": 0.000
      },
      "chapter_out_point": {
        "frame": 387,
        "sec": 12.913
      },
      "sound_bites": [
        {
          "text": "The strikes were a spectacular military success.",
          "speaker_name": "Donald Trump",
          "in_point_frame": 1,
          "in_point": "00:00.031",
          "out_point_frame": 139,
          "out_point": "00:04.641"
        }
      ]
    },
    {
      "title": "Richmond Protest Rally",
      "description": "Anti-war demonstrators gather at Abner Clay Park to oppose the Iran strikes.",
      "representative_keyframe": {
        "frame": 700,
        "sec": 23.356
      },
      "chapter_in_point": {
        "frame": 384,
        "sec": 12.813
      },
      "chapter_out_point": {
        "frame": 1683,
        "sec": 56.156
      },
      "sound_bites": [
        {
          "text": "The people of the United States do not want a war with Iran. That is the majority.",
          "speaker_name": "Rain Burrows",
          "in_point_frame": 1140,
          "in_point": "00:38.056",
          "out_point_frame": 1314,
          "out_point": "00:43.815"
        }
      ]
    },
    {
      "title": "Protester Perspectives",
      "description": "Individual protesters share their concerns about the military action and its potential consequences.",
      "representative_keyframe": {
        "frame": 1740,
        "sec": 58.058
      },
      "chapter_in_point": {
        "frame": 1680,
        "sec": 56.056
      },
      "chapter_out_point": {
        "frame": 2164,
        "sec": 72.205
      },
      "sound_bites": [
        {
          "text": "You know, just as people, we need to be paying attention to what's happening...these actions affect everybody.",
          "speaker_name": "Unidentified Male Protestor",
          "in_point_frame": 1686,
          "in_point": "00:56.250",
          "out_point_frame": 1865,
          "out_point": "00:62.217"
        },
        {
          "text": "Because I'm in touch with my humanity. And I'm, you know, horrified that not everybody else is.",
          "speaker_name": "Unidentified Female Protestor",
          "in_point_frame": 1868,
          "in_point": "00:62.318",
          "out_point_frame": 2059,
          "out_point": "00:68.685"
        }
      ]
    },
    {
      "title": "Virginia Political Reactions",
      "description": "Divided responses from Virginia's Republican and Democratic lawmakers to the Iran strikes.",
      "representative_keyframe": {
        "frame": 2330,
        "sec": 77.744
      },
      "chapter_in_point": {
        "frame": 2161,
        "sec": 72.105
      },
      "chapter_out_point": {
        "frame": 3151,
        "sec": 105.139
      },
      "sound_bites": []
    },
    {
      "title": "Congressional Authorization Concerns",
      "description": "Senator Warner raises questions about military action without congressional consultation.",
      "representative_keyframe": {
        "frame": 3185,
        "sec": 106.279
      },
      "chapter_in_point": {
        "frame": 3148,
        "sec": 105.039
      },
      "chapter_out_point": {
        "frame": 3934,
        "sec": 131.264
      },
      "sound_bites": []
    },
    {
      "title": "Fear of Retaliation",
      "description": "Protesters express concerns about potential Iranian retaliation and escalating conflict.",
      "representative_keyframe": {
        "frame": 4038,
        "sec": 134.748
      },
      "chapter_in_point": {
        "frame": 3931,
        "sec": 131.164
      },
      "chapter_out_point": {
        "frame": 4290,
        "sec": 143.143
      },
      "sound_bites": [
        {
          "text": "And now we're bombing Iran. And I'm just waiting for it to come back and start falling in our laps.",
          "speaker_name": "Unidentified Female Protestor",
          "in_point_frame": 3942,
          "in_point": "01:31.540",
          "out_point_frame": 4135,
          "out_point": "01:37.973"
        }
      ]
    }
  ],
  "key_entities": [
    {
      "name": "Donald Trump",
      "keyframe_image": {
        "frame": 60,
        "sec": 2.002
      },
      "bounding_box": {
        "width": 180,
        "height": 180,
        "x": 550,
        "y": 145
      },
      "entity_role": "subject",
      "entity_flags": ["subject"],
      "details": [
        "President of the United States",
        "Announced military strikes on Iran's nuclear facilities",
        "Described strikes as 'spectacular military success'"
      ]
    },
    {
      "name": "Rain Burrows",
      "keyframe_image": {
        "frame": 700,
        "sec": 23.356
      },
      "bounding_box": {
        "width": 260,
        "height": 260,
        "x": 510,
        "y": 110
      },
      "entity_role": "subject",
      "entity_flags": ["subject"],
      "details": [
        "Representative of Veterans for Peace",
        "Anti-war protest organizer",
        "Stated majority of Americans oppose war with Iran"
      ]
    },
    {
      "name": "John McGuire",
      "keyframe_image": {
        "frame": 2300,
        "sec": 76.743
      },
      "bounding_box": {
        "width": 120,
        "height": 120,
        "x": 265,
        "y": 250
      },
      "entity_role": "subject",
      "entity_flags": ["subject"],
      "details": [
        "Republican Congressman from Virginia",
        "Supported Trump's Iran strikes",
        "Stated Iran can never be allowed nuclear weapons"
      ]
    },
    {
      "name": "Glenn Youngkin",
      "keyframe_image": {
        "frame": 2775,
        "sec": 92.592
      },
      "bounding_box": {
        "width": 210,
        "height": 210,
        "x": 535,
        "y": 140
      },
      "entity_role": "subject",
      "entity_flags": ["subject"],
      "details": [
        "Governor of Virginia",
        "Praised Trump for keeping promises on Iran",
        "Posted supportive message on social media"
      ]
    },
    {
      "name": "Mark Warner",
      "keyframe_image": {
        "frame": 3165,
        "sec": 105.612
      },
      "bounding_box": {
        "width": 270,
        "height": 270,
        "x": 505,
        "y": 95
      },
      "entity_role": "subject",
      "entity_flags": ["subject"],
      "details": [
        "Democratic Senator from Virginia",
        "Vice Chairman of Senate Intelligence Committee",
        "Questioned lack of congressional authorization for strikes"
      ]
    },
    {
      "name": "SPEAKER_02",
      "keyframe_image": null,
      "bounding_box": null,
      "entity_role": "journalist",
      "affiliation": "Unknown",
      "entity_flags": ["journalist", "narrator"],
      "details": [
        "Role: Journalist narrator",
        "Affiliation: Unknown",
        "Contribution: Provides story narration and context"
      ]
    }
  ]
};

        const isJournalist = (e) =>
            e?.entity_role === "journalist" || e?.entity_flags?.includes("journalist");

        // --- DYNAMIC PAGE BUILDER ---
        document.addEventListener('DOMContentLoaded', () => {
            const container = document.getElementById('dope-sheet-container');
            if (!container || !dopeSheetData) {
                console.error("Container or data not found!");
                return;
            }

            // --- NEW: Separate the journalist from other entities ---
            const journalistEntity = (dopeSheetData.key_entities || []).find(isJournalist);
            const regularEntities  = (dopeSheetData.key_entities || []).filter(e => !isJournalist(e));

            const entityImageMap = new Map();
            dopeSheetData.key_entities.forEach((entity, index) => {
                const imageUrl = `entity_${index + 1}.jpg`;
                entityImageMap.set(entity.name, imageUrl);
            });

            document.title = dopeSheetData.headline || 'Interactive Dope Sheet';
            const formatSynopsis = (text) => text.split('\n\n').map(p => `<p class="mb-4">${p}</p>`).join('');
            const descriptiveTags = dopeSheetData.descriptive_tags || dopeSheetData.tone_tags || [];

            // --- UPDATED: This entire innerHTML block is new ---
            container.innerHTML = `
                <header class="mb-12">
                    <h1 class="text-3xl md:text-4xl font-bold text-slate-900 mb-2">${dopeSheetData.headline}</h1>
                    <p class="text-lg text-slate-600 italic">${dopeSheetData.summary}</p>
                    ${ (descriptiveTags.length > 0) ? `<div class="flex items-center gap-2 text-sm text-slate-500 font-medium mt-3">${descriptiveTags.map(tag => `<span>${tag}</span>`).join('<span class="mx-1">&middot;</span>')}</div>` : '' }

                <main>
                    <section id="video-player-container" class="mb-8">
                        <video id="main-video" controls class="w-full rounded-lg shadow-lg bg-black" poster="thumbnail.jpg">
                            <source src="video10.mp4" type="video/mp4">
                            Your browser does not support the video tag.
                        </video>
                    </section>

                    <section id="synopsis" class="mb-8 bg-white p-6 rounded-lg shadow-sm">
                        <h2 class="text-2xl font-bold border-b pb-2 mb-4">Synopsis</h2>
                        <div>${formatSynopsis(dopeSheetData.synopsis)}</div>
                    </section>

                    <section id="topic-tags" class="mb-8">
                        <h2 class="text-2xl font-bold border-b pb-2 mb-4">Topic Tags</h2>
                        <div class="flex flex-wrap gap-2">${dopeSheetData.topic_tags.map(tag => `<span class="bg-sky-100 text-sky-800 text-sm font-medium px-3 py-1 rounded-full">${tag}</span>`).join('')}</div>
                    </section>
                    
                    ${journalistEntity ? `
                    <section id="journalist" class="mb-8">
                    <h2 class="text-2xl font-bold border-b pb-2 mb-4">Journalist</h2>
                    <div class="bg-white p-4 rounded-lg shadow-sm flex items-center gap-5">
                        ${journalistEntity.keyframe_image ? `
                        <img src="entity_${dopeSheetData.key_entities.indexOf(journalistEntity) + 1}.jpg"
                            alt="${journalistEntity.name}"
                            class="w-20 h-20 rounded-full object-cover bg-slate-200 flex-shrink-0">
                        ` : ''}

                        <div class="flex-grow">
                        <div class="flex items-center gap-2 flex-wrap">
                            <h3 class="font-bold text-lg text-slate-900">${journalistEntity.name}</h3>
                            <span class="text-xs uppercase tracking-wide px-2 py-1 rounded-full bg-slate-800 text-white">Journalist</span>
                            ${journalistEntity.affiliation ? `
                            <span class="text-xs px-2 py-1 rounded-full bg-sky-100 text-sky-800">
                                ${journalistEntity.affiliation}
                            </span>` : `
                            <span class="text-xs px-2 py-1 rounded-full bg-amber-100 text-amber-800">
                                Affiliation: Unknown
                            </span>`}
                        </div>

                        <ul class="w-full text-sm text-slate-600 mt-2 list-disc list-outside ml-4 text-left">
                            ${ (journalistEntity.details || []).map(detail => `<li>${detail}</li>`).join('') }
                        </ul>
                        </div>
                    </div>
                    </section>
                    ` : '' }

                    ${regularEntities.length > 0 ? `
                    <section id="key-entities" class="mb-8">
                        <h2 class="text-2xl font-bold border-b pb-2 mb-4">Main Characters</h2>
                        <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4">
                            ${regularEntities.map(entity => {
                                const originalIndex = dopeSheetData.key_entities.indexOf(entity);
                                return `
                                <div class="bg-white p-4 rounded-lg shadow-sm flex flex-col items-center text-center">
                                    <img src="entity_${originalIndex + 1}.jpg" alt="${entity.name}" class="w-24 h-24 rounded-full mb-3 object-cover bg-slate-200">
                                    <div class="flex items-center gap-2 flex-wrap">
                                        <h3 class="font-bold text-lg text-slate-900">${entity.name}</h3>
                                        ${entity.entity_role ? `<span class="text-xs px-2 py-1 rounded-full bg-slate-100 text-slate-700">
                                            ${entity.entity_role}
                                        </span>` : ''}
                                        </div>
                                    <ul class="text-sm text-slate-600 mt-2 list-disc list-outside text-left ps-8">${entity.details.map(detail => `<li>${detail}</li>`).join('')}</ul>
                                </div>
                            `}).join('')}
                        </div>
                    </section>
                    ` : ''}
                    
                    <section id="key-chapters">
                        <h2 class="text-2xl font-bold border-b pb-2 mb-4">Story Beats</h2>
                        <div class="space-y-6">
                            ${dopeSheetData.chapters.map((chapter, index) => `
                                <div class="key-chapter bg-white p-4 rounded-lg shadow-sm flex flex-col md:flex-row gap-4 items-start">
                                    <div class="w-full md:w-1/3 flex-shrink-0">
                                        <video id="chapter-video-${index}" class="chapter-video w-full rounded-md cursor-pointer bg-black"
                                            poster="chapter_${index + 1}.jpg"
                                            preload="metadata" muted loop
                                            data-video-id="chapter-video-${index}"
                                            data-start-time="${chapter.chapter_in_point.sec}">
                                            <source src="video10.mp4" type="video/mp4">
                                        </video>
                                    </div>
                                    <div class="key-chapter-text flex-grow">
                                        <h3 class="timestamp-link text-lg font-semibold text-sky-700 hover:text-sky-900 cursor-pointer" 
                                            data-video-id="chapter-video-${index}" 
                                            data-start-time="${chapter.chapter_in_point.sec}">
                                            ${chapter.title}
                                        </h3>
                                        <p class="text-slate-600 mt-1">${chapter.description}</p>
                                        ${chapter.sound_bites.map(sb => `
                                            <figure class="mt-4">
                                                <blockquote class="soundbite-quote m-0 p-0 border-l-4 border-slate-200 pl-3">
                                                    <p>"${sb.text}"</p>
                                                </blockquote>
                                                <figcaption class="text-right text-sm font-semibold text-slate-700 mt-1">- ${sb.speaker_name}</figcaption>
                                            </figure>
                                        `).join('')}
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </section>
                </main>
            `;
            
            setupVideoInteractivity();
        });

        function setupVideoInteractivity() {
            const mainVideo = document.getElementById('main-video');
            
            // This will keep track of which chapter thumbnail was clicked
            let lastClickedchapterVideo = null;

            // When the main video finishes playing, reset the last clicked thumbnail to show its poster
            mainVideo.addEventListener('ended', () => {
                if (lastClickedchapterVideo) {
                    lastClickedchapterVideo.load(); // .load() resets the video element to its initial state
                    lastClickedchapterVideo = null; // Clear the tracker
                }
            });

            // Handle clicks on any key chapter title or thumbnail
            document.getElementById('key-chapters').addEventListener('click', (event) => {
                const target = event.target.closest('.timestamp-link, .chapter-video');
                if (!target) return;

                // Find the specific <video> element for the chapter that was clicked
                const clickedVideoId = target.dataset.videoId;
                if (!clickedVideoId) return;
                
                const clickedVideoElement = document.getElementById(clickedVideoId);
                
                // If another chapter's playback was triggered previously, reset its thumbnail first
                if (lastClickedchapterVideo && lastClickedchapterVideo !== clickedVideoElement) {
                     lastClickedchapterVideo.load();
                }

                // Store a reference to the new chapter video that was clicked
                lastClickedchapterVideo = clickedVideoElement;

                // Get the start time from the element's data attribute
                const startTime = parseFloat(target.dataset.startTime);
                
                // Jump the main video to the correct time and play
                mainVideo.currentTime = startTime;
                mainVideo.play();

                // Bring the main video into view for the user for a better experience
                mainVideo.scrollIntoView({ behavior: 'smooth', block: 'center' });
            });
        }
    </script>

</body>
</html>